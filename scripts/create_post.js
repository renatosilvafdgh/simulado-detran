
import { createClient } from '@supabase/supabase-js'

const SUPABASE_URL = "https://uebewihyttehjdzazsku.supabase.co"
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlYmV3aWh5dHRlaGpkemF6c2t1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODI0NzUsImV4cCI6MjA4Njc1ODQ3NX0.6f_NJ8L_7ZydmrnNS8aOmdT5mquOytlc22ugsq-KU0o"

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

const postData = {
    "title": "CNH 2026: O Guia Estratégico da Nova Habilitação Digital e o Fim do Monopólio das Autoescolas",
    "content": "# A Revolução na Mobilidade: O Cenário da CNH em 2026\n\nO ano de 2026 consolida uma mudança de paradigma na gestão da mobilidade urbana no Brasil. A transição do modelo tradicional, historicamente marcado por uma burocracia processual e custos proibitivos, para um sistema digital centrado na competência do condutor, representa um alinhamento estratégico com padrões internacionais de formação. Esta reforma não é apenas uma simplificação administrativa; é uma política de Estado voltada para a dinamização da economia, removendo barreiras de entrada que, por décadas, segregaram o acesso ao direito de dirigir.\n\nEsta transformação é sustentada pelos pilares da **Resolução 1020/2025 do Contran** e da **Medida Provisória nº 1327/2025**. Juntos, esses instrumentos jurídicos desarticulam o antigo monopólio de formação ao extinguir a obrigatoriedade de aulas teóricas presenciais e reduzir drasticamente a carga horária prática mínima. Ao migrar a jornada do candidato para um ecossistema digital e flexível, o governo promove uma desburocratização sem precedentes. O impacto mais tangível dessa reforma institucional é, fundamentalmente, o alívio financeiro direto para o cidadão.\n\n## Análise Econômica: Como o Custo da Habilitação Reduziu em até 80%\n\nA queda acentuada nos custos de habilitação em 2026 decorre da abertura do mercado de instrução. O fim da obrigatoriedade das Centros de Formação de Condutores (CFCs) para etapas teóricas e a permissão para a contratação de **instrutores autônomos credenciados** alteraram a dinâmica de preços. Agora, o candidato deixa de pagar por pacotes fechados de 45h teóricas e 20h práticas, contratando apenas o treinamento necessário para atingir a proficiência técnica.\n\nAbaixo, apresentamos uma síntese comparativa baseada nos dados reais de Minas Gerais, evidenciando a eficiência do novo modelo:\n\n| Etapa / Item | Modelo Antigo (2025) | Modelo CNH do Brasil (2026) | Impacto Estratégico |\n| :--- | :--- | :--- | :--- |\n| **Curso Teórico** | R$ 319,52 | **Gratuito** | Digitalização via Ministério dos Transportes |\n| **Aulas Práticas** | R$ 1.426,00 (20h) | **R$ 140,00 (2h)** | Fim da carga horária mínima excessiva |\n| **Exame Médico/Psi** | R$ 439,86 | **R$ 180,00** | Teto fixado pela MP 1327/2025 |\n| **Aluguel de Veículo** | R$ 226,67 | **Gratuito** | Possibilidade de uso de veículo próprio |\n| **Licença (LADV)** | R$ 82,97 | **Gratuito** | Emissão integrada via aplicativo |\n| **Exame Toxicológico**| Não exigido | R$ 120,00 | Nova obrigatoriedade de segurança |\n| **Taxas Detran (MG)** | R$ 221,24 | R$ 221,24 | Valor mantido com reteste gratuito |\n| **VALOR TOTAL** | **R$ 2.255,99** | **R$ 661,24** | **Redução real de ~70,7%** |\n\nA redução de custos é impulsionada pela extinção de taxas intermediárias, como a Licença de Aprendizagem (LADV), agora integrada ao sistema digital. Essa economia viabiliza a entrada de milhões de novos condutores no ecossistema digital da mobilidade.\n\n## CNH do Brasil: O Aplicativo como Eixo Central da Formação\n\nA digitalização removeu intermediários e centralizou a jornada do condutor na plataforma governamental **CNH do Brasil**. Integrado ao sistema gov.br, o aplicativo atua como o motor de governança de todo o processo de formação, garantindo que o certificado teórico seja emitido e registrado **automaticamente no Sistema Nacional de Trânsito (SNT)** após a conclusão dos módulos.\n\n### Jornada Digital do Candidato:\n1.  **Abertura do Requerimento:** Realizada diretamente na aba \"Condutor\", com recuperação automática de dados biométricos.\n2.  **Curso Teórico Gratuito:** Trilha multimídia com vídeos, podcasts e e-books. O fim das 45h presenciais democratiza o acesso para trabalhadores da *gig economy*, que agora gerem seu tempo de estudo de forma assíncrona.\n3.  **Simulados Oficiais:** Testes de conhecimento com inteligência artificial que focam nas competências exigidas pelo Detran.\n4.  **Agendamento e Biometria:** Centralização de exames médicos (respeitando o teto de R$ 180) e coleta de digitais.\n5.  **Emissão da PPD e CNH-e:** Após a aprovação, a Permissão para Dirigir (PPD) é liberada digitalmente, com validade de 12 meses.\n\nEste modelo elimina a ociosidade burocrática e foca na autonomia do aluno. Além da tecnologia, a política pública se estende à base da pirâmide através da CNH Social.\n\n## CNH Social 2026: Ampliando o Acesso à Baixa Renda\n\nEm 2026, a CNH Social atua como uma ferramenta de política ativa de emprego. Ao utilizar recursos de multas de trânsito para custear o processo de cidadãos vulneráveis, o Estado promove a formalização de trabalhadores no setor de transportes e logística.\n\n**Metas e Estados Participantes:**\n*   **Paraná:** Abertura de editais com meta de 5 mil vagas iniciais.\n*   **Piauí:** Programa focado em beneficiar 10 mil estudantes.\n*   **Maranhão:** Consolidação após recorde de 317 mil inscritos em fases prévias.\n*   **Adesão Nacional:** Ceará (CNH Popular), Amazonas, Acre, Espírito Santo, Goiás, Rio Grande do Sul e outros já operam o benefício integral.\n\n**Critérios de Elegibilidade (Socioeconômicos):**\n*   Inscrição ativa no **CadÚnico** (Cadastro Único);\n*   Renda familiar per capita de até meio salário mínimo (R$ 706);\n*   Idade mínima de 18 anos e solicitação da primeira habilitação.\n\nO programa cobre exames, taxas, aulas e garante o primeiro reteste gratuito, neutralizando o fator financeiro como barreira de exclusão.\n\n## O Novo Exame Prático: Foco na Realidade e o Fim da \"Indústria da Reprovação\"\n\nO novo manual de exames de 2026 abandona o modelo punitivo e mecânico. A avaliação agora é baseada em competências reais de condução urbana, com regras técnicas mais precisas e justas.\n\n### Definições Técnicas e Mudanças:\n*   **Baliza Integrada:** Deixou de ser uma etapa isolada. O estacionamento ocorre no percurso, utilizando o conceito de **Vaga Útil** (comprimento do veículo + 50%) e **Zona de Tolerância Longitudinal** (veículo + 30% de espaço livre para manobra), totalizando um trecho livre de aproximadamente 11,20m para carros médios.\n*   **Sistema de Pontuação de Competência:** O candidato não é mais eliminado por erros leves. O limite é de **10 pontos**, com o seguinte breakdown: Leve (1 pt), Média (2 pts), Grave (4 pts) e Gravíssima (6 pts).\n*   **Autonomia do Veículo:** É permitido o uso de veículo próprio (limite de 8 anos para motos e 12 para carros) ou de instrutores autônomos, eliminando as taxas abusivas de aluguel das autoescolas.\n*   **Reteste Gratuito:** Como medida de combate à **\"indústria da reprovação\"**, o primeiro reteste é gratuito e pode ser realizado no mesmo dia, caso haja disponibilidade de agenda.\n\n## Conclusão: A CNH como Recompensa ao Bom Condutor\n\nA reforma de 2026 encerra uma era de privilégios de intermediários para inaugurar a era da autonomia. O sistema não apenas facilita a entrada, mas premia a permanência segura no trânsito através da **MP do Bom Condutor**: motoristas que não registrarem pontos em 12 meses terão renovação automática e gratuita até os 50 anos. A conquista da CNH em 2026 é, finalmente, o exercício pleno de uma cidadania digital, moderna e acessível a todos os brasileiros.",
    "meta_title": "CNH 2026: Guia da Habilitação sem Autoescola e com 70% de Desconto",
    "meta_description": "Tire sua CNH 2026 sem autoescola! Conheça as novas regras de instrutores autônomos, reteste gratuito, app CNH do Brasil e como economizar até 80% no processo.",
    "hashtags": "CNHSocial2026, CNHdoBrasil, Detran2026, PrimeiraHabilitacao, MobilidadeDigital"
}

function slugify(text) {
    return text.toString().toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // Remove accents
        .replace(/\s+/g, '-')           // Replace spaces with -
        .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
        .replace(/\-\-+/g, '-')         // Replace multiple - with single -
        .replace(/^-+/, '')             // Trim - from start of text
        .replace(/-+$/, '');            // Trim - from end of text
}

async function run() {
    console.log('Signing up temp user to create post...')

    const email = `admin.blog.${Date.now()}@souhabilitado.com`
    const password = `Pass${Date.now()}!`

    const { data: { user, session }, error: authError } = await supabase.auth.signUp({
        email,
        password
    })

    if (authError) {
        console.error('Auth Error:', JSON.stringify(authError, null, 2))
    }

    if (!session) {
        console.log('No session returned (email confirmation likely required).')
        console.log('Cannot insert via API. Here is the SQL to run manually:')
        console.log('-----------------------------------------------------')
        console.log(`INSERT INTO blog_posts (title, slug, content, excerpt, image_url, category, tags, published, published_at, views, author_id)
VALUES (
  '${postData.title.replace(/'/g, "''")}',
  '${slugify(postData.title)}',
  '${postData.content.replace(/'/g, "''").replace(/\n/g, "' || chr(10) || '")}',
  '${postData.meta_description.replace(/'/g, "''")}',
  NULL,
  'Notícias',
  ARRAY[${postData.hashtags.split(',').map(t => `'${t.trim()}'`).join(', ')}],
  true,
  NOW(),
  0,
  auth.uid() -- You must run this in SQL Editor where you are logged in, or replace with a valid UUID
);`)
        console.log('-----------------------------------------------------')
        return
    }

    console.log('User logged in with session. Inserting...')

    const slug = slugify(postData.title)

    const { error } = await supabase
        .from('blog_posts')
        .insert({
            title: postData.title,
            slug: slug,
            content: postData.content,
            excerpt: postData.meta_description,
            image_url: null,
            category: 'Notícias',
            tags: postData.hashtags.split(',').map(t => t.trim()),
            published: true,
            published_at: new Date().toISOString(),
            views: 0,
            author_id: user.id
        })

    if (error) {
        console.error('Insert Error:', error)
    } else {
        console.log('Post created successfully:', slug)
    }
}

run()
